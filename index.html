<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ìì„±ì–´ ìŠ¤í”¼ë“œ O/X í€´ì¦ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body { text-align: center; font-family: 'Jua', sans-serif; background-color: #E8F5E9; margin: 0; padding: 20px; }
        h1 { color: #2E7D32; font-size: 36px; margin-bottom: 5px; }
        .game-box { background: white; max-width: 500px; margin: 0 auto; border-radius: 20px; padding: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border: 4px solid #4DB6AC; }
        #question-area { font-size: 24px; color: #333; margin: 20px 0; min-height: 80px; display: flex; align-items: center; justify-content: center; word-break: keep-all; line-height: 1.4; background: #F1F8E9; border-radius: 10px; padding: 10px; }
        #webcam-container { position: relative; width: 100%; border-radius: 15px; overflow: hidden; background: black; margin: 0 auto; }
        #timer-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; font-weight: bold; color: #FFEB3B; text-shadow: 4px 4px 10px rgba(0,0,0,0.8); display: none; pointer-events: none; }
        #result-area { font-size: 32px; font-weight: bold; margin-top: 10px; height: 50px; }
        .correct { color: #1976D2; } .wrong { color: #D32F2F; }
        button { font-size: 24px; padding: 15px 40px; background: #2E7D32; color: white; border: none; border-radius: 50px; cursor: pointer; font-family: 'Jua'; margin-top: 20px; box-shadow: 0 4px 0 #1B5E20; }
        button:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>
    <div class="game-box">
        <h1>ğŸ¦ ì‚¬ìì„±ì–´ O/X í€´ì¦ˆ</h1>
        <p>3ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ í›„ ì •ë‹µ í¬ì¦ˆ!</p>
        <div id="webcam-container">
            <div id="timer-overlay">3</div>
        </div>
        <div id="question-area">ì¤€ë¹„ë˜ë©´ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”!</div>
        <div id="result-area"></div>
        <button type="button" onclick="startQuiz()" id="btn-start">ê²Œì„ ì‹œì‘ â–¶</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/0-DHo9maw/";
        
        // ğŸ”¥ ë‚˜ì¤‘ì— 8ì£¼ì°¨ í•  ë•Œ ì—¬ê¸°ì— ì£¼ì†Œ ë„£ì„ ê±°ì•¼! (ì§€ê¸ˆì€ ë¹„ì›Œë‘¬ë„ ë¨)
        const SHEET_WEBAPP_URL = ""; 

        const quizData = [
            { q: "Q1. [ìœ ë¹„ë¬´í™˜]<br>ë¹„ê°€ ë‚´ë¦¬ë©´ í™˜ìê°€ ì—†ë‹¤ëŠ” ëœ»ì´ë‹¤?", a: "X" }, 
            { q: "Q2. [ê¸ˆì‹œì´ˆë¬¸]<br>ì´ì œì•¼ ë¹„ë¡œì†Œ ì²˜ìŒ ë“¤ì—ˆë‹¤ëŠ” ëœ»ì´ë‹¤?", a: "O" },
            { q: "Q3. [ë™ë¬¸ì„œë‹µ]<br>ë™ìª½ì„ ë¬»ëŠ”ë° ì„œìª½ì„ ë‹µí•œë‹¤ëŠ” ëœ»ì´ë‹¤?", a: "O" } 
        ];

        let model, webcam, maxPredictions;
        let currentIdx = 0;

        async function startQuiz() {
            const btn = document.getElementById("btn-start");
            if (!model) {
                btn.innerText = "ë¡œë”© ì¤‘...â³";
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                const flip = true; 
                webcam = new tmImage.Webcam(300, 300, flip); 
                await webcam.setup(); 
                await webcam.play();
                window.requestAnimationFrame(loop);
                document.getElementById("webcam-container").appendChild(webcam.canvas);
                document.getElementById("webcam-container").appendChild(document.getElementById("timer-overlay"));
            }
            btn.style.display = "none"; 
            currentIdx = 0;
            nextQuestion();
        }

        async function loop() { webcam.update(); window.requestAnimationFrame(loop); }

        function nextQuestion() {
            if (currentIdx >= quizData.length) {
                document.getElementById("question-area").innerHTML = "ğŸ‰ í€´ì¦ˆ ì¢…ë£Œ! ğŸ‰";
                document.getElementById("result-area").innerText = "ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!";
                const btn = document.getElementById("btn-start");
                btn.innerText = "ë‹¤ì‹œ í•˜ê¸° ğŸ”„";
                btn.style.display = "inline-block";
                return;
            }
            document.getElementById("result-area").innerText = "";
            document.getElementById("question-area").innerHTML = quizData[currentIdx].q;
            setTimeout(startCountdown, 2500);
        }

        function startCountdown() {
            let count = 3;
            const timerDiv = document.getElementById("timer-overlay");
            timerDiv.style.display = "block";
            timerDiv.innerText = count;
            const timer = setInterval(() => {
                count--;
                if (count > 0) timerDiv.innerText = count;
                else {
                    clearInterval(timer);
                    timerDiv.innerText = "ì°°ì¹µ!";
                    checkAnswer(); 
                    setTimeout(() => { timerDiv.style.display = "none"; }, 1000);
                }
            }, 1000);
        }

        async function checkAnswer() {
            const prediction = await model.predict(webcam.canvas);
            let userPose = "";
            let maxProb = 0;
            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > maxProb) {
                    maxProb = prediction[i].probability;
                    userPose = prediction[i].className; 
                }
            }

            const correctAnswer = quizData[currentIdx].a; 
            const resultDiv = document.getElementById("result-area");
            let isCorrect = userPose.toUpperCase().includes(correctAnswer);
            let resultText = isCorrect ? "ì •ë‹µ(O)" : "ì˜¤ë‹µ(X)";

            if (isCorrect) resultDiv.innerHTML = `<span class="correct">â­• ì •ë‹µ!</span>`;
            else resultDiv.innerHTML = `<span class="wrong">âŒ ë•¡!</span> (ì¸ì‹: ${userPose})`;

            // ë‚˜ì¤‘ì— ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì—°ê²°ë˜ë©´ ì—¬ê¸°ì„œ ë°ì´í„° ì „ì†¡í•¨
            if (SHEET_WEBAPP_URL) {
                fetch(SHEET_WEBAPP_URL, {
                    method: "POST",
                    body: new URLSearchParams({ "name": (currentIdx + 1) + "ë²ˆ ë¬¸ì œ", "message": resultText })
                });
            }

            currentIdx++;
            setTimeout(nextQuestion, 3000);
        }
    </script>
</body>
</html>